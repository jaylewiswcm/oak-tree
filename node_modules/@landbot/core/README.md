# Landbot - Core

Landbot client core. Connects to the messaging database and the landbot app servers.

# Getting started

Choose a way to get started with landbot-core.

### ES6

```bash
npm install @landbot/core
```

Import it in your app.

```javascript
import LandbotCore from '@landbot/core';
import * as firebase from 'firebase/app';
import 'firebase/auth';
import 'firebase/database';

const core = new LandbotCore({
  firebase, // required
  configUrl: 'https://chats.landbot.io/u/H-441480-B0Q96FP58V53BJ2J/index.html', // Your landbot URL
});
```

### In the browser

```html
<script src="https://static.landbot.io/landbot-core/landbot-core.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-database.js"></script>

<script>
  const core = new Landbot.Core({
    firebase, // required
    configUrl:
      'https://chats.landbot.io/u/H-441480-B0Q96FP58V53BJ2J/index.html', // Your landbot URL
  });
</script>
```

## Methods

- `init`. Core initialization. Returns a Promise that resolves with initialization data and previous conversation messages.

```javascript
core.init().then(function (data) {
  console.log(data.messages);
});
```

- `sendMessage`. Send a message. See the docs for more messaging info.

```javascript
core.sendMessage({ message: 'Hey bro!' });
```

## Pipelines

It's hard to get an ordered flow of messages when they are dropped from an external service almost instantly. Thanks to pipelines, you can create a listener for incoming messages in your application.

- `$sequence`. Used to get a sequential flow of messages.

```javascript
core.pipelines.$sequence.subscribe(function (message) {
  console.log(message);
});
```

- `$readableSequence`. Used to get a sequential flow of messages, including an extra delay between each one. Each delay is obtained from its previous message, improving readability.

```javascript
core.pipelines.$readableSequence.subscribe(function (message) {
  console.log(message);
});
```

- `$typingSequence`. Used to get a sequential flow of messages with their typing states. Each tick includes information about typing state, delay and message content.

```javascript
core.pipelines.$typingSequence.subscribe(function (data) {
  if (data) {
    console.log(data);
  }
});
```

## Events

- `"new_message"`. Triggered when a new message is received. Don't listen to this event unless you want to deal with a bunch of unordered messages. Use pipelines to get a correct flow of messages and render it on your app.

```javascript
core.events.on('new_message', function (message) {
  console.log(message);
});
```

-`"database.error"`. Triggered when an error occurred in database.

```javascript
core.events.on('database.error', function (data) {
  console.error(data);
});
```

# Examples

- [VueJS Simple chat](https://codesandbox.io/s/landbot-vue-example-bpcv2?file=/src/main.js).
