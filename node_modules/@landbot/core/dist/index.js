!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,(function(){return(()=>{var t={187:t=>{"use strict";var e,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,o),n(r)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}y(t,e,o,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&y(t,"error",e,{once:!0})}(t,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function a(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,r,n){var i,o,s,u;if(c(r),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),s=o[e]),void 0===s)s=o[e]=r,++t._eventsCount;else if("function"==typeof s?s=o[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=a(t))>0&&s.length>i&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=s.length,u=h,console&&console.warn&&console.warn(u)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function l(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):d(i,i.length)}function p(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function d(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function y(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){n.once&&t.removeEventListener(e,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return a(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var a=o[t];if(void 0===a)return!1;if("function"==typeof a)n(a,this,e);else{var u=a.length,h=d(a,u);for(r=0;r<u;++r)n(h[r],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return c(e),this.on(t,f(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,f(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,i,o,s;if(c(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return l(this,t,!0)},o.prototype.rawListeners=function(t){return l(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},208:(t,e,r)=>{var n,i="__lodash_hash_undefined__",o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,c=/^\./,a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,h=/^\[object .+?Constructor\]$/,f="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,l="object"==typeof self&&self&&self.Object===Object&&self,p=f||l||Function("return this")(),d=Array.prototype,y=Function.prototype,b=Object.prototype,v=p["__core-js_shared__"],g=(n=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",_=y.toString,m=b.hasOwnProperty,w=b.toString,S=RegExp("^"+_.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),O=p.Symbol,x=d.splice,T=P(p,"Map"),E=P(Object,"create"),j=O?O.prototype:void 0,k=j?j.toString:void 0;function L(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function C(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function M(t,e){for(var r,n,i=t.length;i--;)if((r=t[i][0])===(n=e)||r!=r&&n!=n)return i;return-1}function N(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function P(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!D(t)||(e=t,g&&g in e))&&(function(t){var e=D(t)?w.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?S:h).test(function(t){if(null!=t){try{return _.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}(r)?r:void 0}L.prototype.clear=function(){this.__data__=E?E(null):{}},L.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},L.prototype.get=function(t){var e=this.__data__;if(E){var r=e[t];return r===i?void 0:r}return m.call(e,t)?e[t]:void 0},L.prototype.has=function(t){var e=this.__data__;return E?void 0!==e[t]:m.call(e,t)},L.prototype.set=function(t,e){return this.__data__[t]=E&&void 0===e?i:e,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(t){var e=this.__data__,r=M(e,t);return!(r<0||(r==e.length-1?e.pop():x.call(e,r,1),0))},C.prototype.get=function(t){var e=this.__data__,r=M(e,t);return r<0?void 0:e[r][1]},C.prototype.has=function(t){return M(this.__data__,t)>-1},C.prototype.set=function(t,e){var r=this.__data__,n=M(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},A.prototype.clear=function(){this.__data__={hash:new L,map:new(T||C),string:new L}},A.prototype.delete=function(t){return N(this,t).delete(t)},A.prototype.get=function(t){return N(this,t).get(t)},A.prototype.has=function(t){return N(this,t).has(t)},A.prototype.set=function(t,e){return N(this,t).set(t,e),this};var I=$((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(F(t))return k?k.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var r=[];return c.test(t)&&r.push(""),t.replace(a,(function(t,e,n,i){r.push(n?i.replace(u,"$1"):e||t)})),r}));function U(t){if("string"==typeof t||F(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function $(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new($.Cache||A),r}$.Cache=A;var R=Array.isArray;function D(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function F(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==w.call(t)}t.exports=function(t,e,r){var n=null==t?void 0:function(t,e){for(var r,n=0,i=(e=function(t,e){if(R(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!F(t))||s.test(t)||!o.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:R(r=e)?r:I(r)).length;null!=t&&n<i;)t=t[U(e[n++])];return n&&n==i?t:void 0}(t,e);return void 0===n?r:n}},468:(t,e,r)=>{var n,i="__lodash_hash_undefined__",o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,c=/^\./,a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,h=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,l="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,p="object"==typeof self&&self&&self.Object===Object&&self,d=l||p||Function("return this")(),y=Array.prototype,b=Function.prototype,v=Object.prototype,g=d["__core-js_shared__"],_=(n=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",m=b.toString,w=v.hasOwnProperty,S=v.toString,O=RegExp("^"+m.call(w).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x=d.Symbol,T=y.splice,E=U(d,"Map"),j=U(Object,"create"),k=x?x.prototype:void 0,L=k?k.toString:void 0;function C(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function M(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function N(t,e,r){var n=t[e];w.call(t,e)&&q(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function P(t,e){for(var r=t.length;r--;)if(q(t[r][0],e))return r;return-1}function I(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function U(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!H(t)||(e=t,_&&_ in e))&&(function(t){var e=H(t)?S.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?O:h).test(function(t){if(null!=t){try{return m.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}(r)?r:void 0}function $(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||f.test(t))&&t>-1&&t%1==0&&t<e}C.prototype.clear=function(){this.__data__=j?j(null):{}},C.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},C.prototype.get=function(t){var e=this.__data__;if(j){var r=e[t];return r===i?void 0:r}return w.call(e,t)?e[t]:void 0},C.prototype.has=function(t){var e=this.__data__;return j?void 0!==e[t]:w.call(e,t)},C.prototype.set=function(t,e){return this.__data__[t]=j&&void 0===e?i:e,this},A.prototype.clear=function(){this.__data__=[]},A.prototype.delete=function(t){var e=this.__data__,r=P(e,t);return!(r<0||(r==e.length-1?e.pop():T.call(e,r,1),0))},A.prototype.get=function(t){var e=this.__data__,r=P(e,t);return r<0?void 0:e[r][1]},A.prototype.has=function(t){return P(this.__data__,t)>-1},A.prototype.set=function(t,e){var r=this.__data__,n=P(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},M.prototype.clear=function(){this.__data__={hash:new C,map:new(E||A),string:new C}},M.prototype.delete=function(t){return I(this,t).delete(t)},M.prototype.get=function(t){return I(this,t).get(t)},M.prototype.has=function(t){return I(this,t).has(t)},M.prototype.set=function(t,e){return I(this,t).set(t,e),this};var R=F((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(W(t))return L?L.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var r=[];return c.test(t)&&r.push(""),t.replace(a,(function(t,e,n,i){r.push(n?i.replace(u,"$1"):e||t)})),r}));function D(t){if("string"==typeof t||W(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function F(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new(F.Cache||M),r}function q(t,e){return t===e||t!=t&&e!=e}F.Cache=M;var V=Array.isArray;function H(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function W(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==S.call(t)}t.exports=function(t,e,r){return null==t?t:function(t,e,r,n){if(!H(t))return t;for(var i=-1,c=(e=function(t,e){if(V(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!W(t))||s.test(t)||!o.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:function(t){return V(t)?t:R(t)}(e)).length,a=c-1,u=t;null!=u&&++i<c;){var h=D(e[i]),f=r;if(i!=a){var l=u[h];void 0===(f=n?n(l,h,u):void 0)&&(f=H(l)?l:$(e[i+1])?[]:{})}N(u,h,f),u=u[h]}return t}(t,e,r)}},633:(t,e,r)=>{var n,i="__lodash_hash_undefined__",o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,c=/^\./,a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,h=/^\[object .+?Constructor\]$/,f="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,l="object"==typeof self&&self&&self.Object===Object&&self,p=f||l||Function("return this")(),d=Array.prototype,y=Function.prototype,b=Object.prototype,v=p["__core-js_shared__"],g=(n=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",_=y.toString,m=b.hasOwnProperty,w=b.toString,S=RegExp("^"+_.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),O=p.Symbol,x=d.splice,T=I(p,"Map"),E=I(Object,"create"),j=O?O.prototype:void 0,k=j?j.toString:void 0;function L(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function C(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function M(t,e){for(var r,n,i=t.length;i--;)if((r=t[i][0])===(n=e)||r!=r&&n!=n)return i;return-1}function N(t){return F(t)?t:$(t)}function P(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function I(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!q(t)||(e=t,g&&g in e))&&(function(t){var e=q(t)?w.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?S:h).test(function(t){if(null!=t){try{return _.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}(r)?r:void 0}function U(t,e){if(F(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!V(t))||s.test(t)||!o.test(t)||null!=e&&t in Object(e)}L.prototype.clear=function(){this.__data__=E?E(null):{}},L.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},L.prototype.get=function(t){var e=this.__data__;if(E){var r=e[t];return r===i?void 0:r}return m.call(e,t)?e[t]:void 0},L.prototype.has=function(t){var e=this.__data__;return E?void 0!==e[t]:m.call(e,t)},L.prototype.set=function(t,e){return this.__data__[t]=E&&void 0===e?i:e,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(t){var e=this.__data__,r=M(e,t);return!(r<0||(r==e.length-1?e.pop():x.call(e,r,1),0))},C.prototype.get=function(t){var e=this.__data__,r=M(e,t);return r<0?void 0:e[r][1]},C.prototype.has=function(t){return M(this.__data__,t)>-1},C.prototype.set=function(t,e){var r=this.__data__,n=M(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},A.prototype.clear=function(){this.__data__={hash:new L,map:new(T||C),string:new L}},A.prototype.delete=function(t){return P(this,t).delete(t)},A.prototype.get=function(t){return P(this,t).get(t)},A.prototype.has=function(t){return P(this,t).has(t)},A.prototype.set=function(t,e){return P(this,t).set(t,e),this};var $=D((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(V(t))return k?k.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var r=[];return c.test(t)&&r.push(""),t.replace(a,(function(t,e,n,i){r.push(n?i.replace(u,"$1"):e||t)})),r}));function R(t){if("string"==typeof t||V(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function D(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new(D.Cache||A),r}D.Cache=A;var F=Array.isArray;function q(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function V(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==w.call(t)}t.exports=function(t,e){return null==t||function(t,e){t=function(t,e){return 1==e.length?t:function(t,e){for(var r=0,n=(e=U(e,t)?[e]:N(e)).length;null!=t&&r<n;)t=t[R(e[r++])];return r&&r==n?t:void 0}(t,function(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(r=r>i?i:r)<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var o=Array(i);++n<i;)o[n]=t[n+e];return o}(e,0,-1))}(t,e=U(e,t)?[e]:N(e));var r,n,i=R((n=(r=e)?r.length:0)?r[n-1]:void 0);return!(null!=t&&m.call(t,i))||delete t[i]}(t,e)}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{ChatsCore:()=>Kt,Core:()=>zt,default:()=>Qt});var t={};r.r(t),r.d(t,{fetch:()=>a});var e={};r.r(e),r.d(e,{getTypingDelay:()=>b,isBotMessage:()=>l,isSystemMessage:()=>p,readingTime:()=>d,wordsAmount:()=>y});var i={};r.r(i),r.d(i,{fixConfigUrl:()=>_,getSafeUrl:()=>g,randomKey:()=>v,storageAvailability:()=>m});var o={};function s(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{a(n.next(t))}catch(t){o(t)}}function c(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,c)}a((n=n.apply(t,e||[])).next())}))}r.r(o),r.d(o,{asyncUtils:()=>t,chatUtils:()=>e,fetch:()=>a,fixConfigUrl:()=>_,getSafeUrl:()=>g,getTypingDelay:()=>b,isBotMessage:()=>l,isSystemMessage:()=>p,randomKey:()=>v,readingTime:()=>d,storageAvailability:()=>m,utils:()=>i,wordsAmount:()=>y}),Object.create,Object.create;const c=window.fetch,a=({url:t,method:e="GET",headers:r={Accept:"application/json"},body:n})=>c(t,{method:e,headers:r,body:n}).then((t=>{if(t.status>=300)throw{code:t.status};return t})).then((t=>t.json()));var u=r(208),h=r.n(u);var f;!function(t){t.AUTO="auto",t.CUSTOM="custom"}(f||(f={}));const l=t=>{const e=Number(t.samurai);return!Number.isNaN(e)&&e<0},p=t=>{const e=Number(t.samurai);return!Number.isNaN(e)&&0===e},d=(t,e={})=>Math.min(6e4/h()(e,"delay.average_human_reading_speed",300)*t,1e3*h()(e,"delay.max_delay",2.5)),y=t=>"string"==typeof t?t.trim().split(/\s+/).length:0,b=(t,e={},r={})=>{const n=h()(e,"extra.typing",f.AUTO),i=h()(e,"extra.typing_delay",0);if(!1===r.state)return 0;if(r.block_custom&&n===f.CUSTOM)return 1e3*i;if(!0===h()(r,"delay.is_constant",!1))return 1e3*h()(r,"delay.constant",0);if(0===e.seq||!t)return 0;switch(t.type){case"text":case"stripe":case"stripe_intent":return d(y(t.message),r);case"dialog":return d(y(t.title||t.message),r);case"image":return 300;default:return 0}},v=(t=20)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="+";for(let n=0;n<t;n++)r=r.concat(e.charAt(Math.floor(Math.random()*e.length)));return r},g=t=>t?"/"===t.slice(-1)?t.slice(0,-1):t:null,_=t=>"string"==typeof t?t.replace(".html",".json"):t,m=(t="localStorage")=>{let e=null;try{e=window[t];const r="__storage_test__";return e.setItem(r,r),e.removeItem(r),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}},w=({serverUrl:t})=>`${t}/webchat/api/firebase/`,S=({serverUrl:t})=>`${t}/webchat/api/send/`,O=({welcomeUrl:t})=>`${t}/visitors/`,x="new_message";class T{constructor(t,e){this.firstTimestamp=0,this.firebaseApp=this._init(t,e)}_init(t,e){e||t.events.emit("database.error",{message:"Error initializing firebase. Firebase module not found!"});const r=`landbot-${t.config.channelToken}`;let n=null;try{n=e.app(r)}catch(t){}return n||e.initializeApp({apiKey:t.config.apiKey,authDomain:t.config.authDomain,databaseURL:t.config.databaseURL,storageBucket:t.config.storageBucket},r)}auth(t){return this.firebaseApp.auth().signInWithCustomToken(t.firebase_token.toString()).then((()=>(this.lastTimestamp=1e3*t.last_timestamp,t)))}authRequest({customerToken:t,channelToken:e,serverUrl:r}){const n={channel_token:e,customer_token:t};return a({url:w({serverUrl:r}),method:"POST",body:JSON.stringify(n)})}destroy(){return Promise.all([this.unsetNewMessageListener(),this.unsetConnectionTrackingListener()]).finally((()=>this.firebaseApp.delete()))}setChatReference(t){this.chatRef=this.firebaseApp.database().ref(t)}setStatusReference(t){this.statusRef=this.firebaseApp.database().ref(t),this.statusRef.set(!0),this.statusRef.onDisconnect().set(!1)}setConnectionTrackingListener(t){const e=e=>{t(e.val())};return this.connectionChangeListener=e.bind(this),this.firebaseApp.database().ref(".info/connected").on("value",e)}unsetConnectionTrackingListener(){return this.firebaseApp.database().ref(".info/connected").off("value",this.connectionChangeListener)}setNewMessageListener(t){return this.newMessageListener=(e=>{const r=e.val();t(Object.assign(Object.assign({},r),{key:e.key,timestamp:1e3*r.timestamp}))}).bind(this),this.chatRef.orderByChild("timestamp").startAt(this.lastTimestamp/1e3).on("child_added",this.newMessageListener)}unsetNewMessageListener(){return this.chatRef?this.chatRef.off("child_added",this.newMessageListener):Promise.resolve()}getLastMessages(t=20){return this.chatRef.orderByChild("timestamp").limitToLast(t).once("value").then((t=>{const e=t.val();return this._updateFirstTimestamp(e),Object.keys(e||{}).forEach((t=>{e[t].key=t,e[t].timestamp*=1e3})),e}))}getMoreMessages(t=20){return this.chatRef.orderByChild("timestamp").endAt(this.firstTimestamp).limitToLast(t).once("value").then((t=>{const e=t.val();return this._updateFirstTimestamp(e),Object.keys(e||{}).forEach((t=>{e[t].key=t,e[t].timestamp*=1e3})),e}))}forceWebSockets(){try{this.firebaseApp.firebase_.database.INTERNAL.forceWebSockets()}catch(t){return console.warn("forceWebSockets call failed (bot will probably fail inside sandboxed iframes).",t),!1}return!0}_updateFirstTimestamp(t){if(t){const e=Object.values(t).sort(((t,e)=>t.timestamp-e.timestamp))[0];e&&(this.firstTimestamp=e.timestamp-.001)}}}var E=r(187),j=r.n(E),k=function(t,e){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function L(t,e){function r(){this.constructor=t}k(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function C(t){return"function"==typeof t}var A=!1,M={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,A=t},get useDeprecatedSynchronousErrorHandling(){return A}};function N(t){setTimeout((function(){throw t}),0)}var P={closed:!0,next:function(t){},error:function(t){if(M.useDeprecatedSynchronousErrorHandling)throw t;N(t)},complete:function(){}},I=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function U(t){return null!==t&&"object"==typeof t}var $=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),R=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,o=r._unsubscribe,s=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var c=0;c<n.length;++c)n[c].remove(this);if(C(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(t){e=t instanceof $?D(t.errors):[t]}}if(I(s)){c=-1;for(var a=s.length;++c<a;){var u=s[c];if(U(u))try{u.unsubscribe()}catch(t){e=e||[],t instanceof $?e=e.concat(D(t.errors)):e.push(t)}}}if(e)throw new $(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=r._parentOrParents;if(null===i)r._parentOrParents=this;else if(i instanceof t){if(i===this)return r;r._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return r;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[r]:o.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function D(t){return t.reduce((function(t,e){return t.concat(e instanceof $?e.errors:e)}),[])}var F=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),q=function(t){function e(r,n,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=P;break;case 1:if(!r){o.destination=P;break}if("object"==typeof r){r instanceof e?(o.syncErrorThrowable=r.syncErrorThrowable,o.destination=r,r.add(o)):(o.syncErrorThrowable=!0,o.destination=new V(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new V(o,r,n,i)}return o}return L(e,t),e.prototype[F]=function(){return this},e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(R),V=function(t){function e(e,r,n,i){var o,s=t.call(this)||this;s._parentSubscriber=e;var c=s;return C(r)?o=r:r&&(o=r.next,n=r.error,i=r.complete,r!==P&&(C((c=Object.create(r)).unsubscribe)&&s.add(c.unsubscribe.bind(c)),c.unsubscribe=s.unsubscribe.bind(s))),s._context=c,s._next=o,s._error=n,s._complete=i,s}return L(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;M.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=M.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):N(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;N(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};M.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),M.useDeprecatedSynchronousErrorHandling)throw t;N(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!M.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return M.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(N(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(q),H=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function W(t){return t}function B(t){return 0===t.length?W:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var Y=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof q)return t;if(t[F])return t[F]()}return t||e||r?new q(t,e,r):new q(P)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||M.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),M.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){M.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,r=e.closed,n=e.destination,i=e.isStopped;if(r||i)return!1;t=n&&n instanceof q?n:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=z(e))((function(e,n){var i;i=r.subscribe((function(e){try{t(e)}catch(t){n(t),i&&i.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[H]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:B(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=z(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function z(t){if(t||(t=M.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var K=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),G=function(t){function e(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return L(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(R),J=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return L(e,t),e}(q),Q=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return L(e,t),e.prototype[F]=function(){return new J(this)},e.prototype.lift=function(t){var e=new Z(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new K;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new K;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new K;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new K;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new K;return this.hasError?(t.error(this.thrownError),R.EMPTY):this.isStopped?(t.complete(),R.EMPTY):(this.observers.push(t),new G(this,t))},e.prototype.asObservable=function(){var t=new Y;return t.source=this,t},e.create=function(t,e){return new Z(t,e)},e}(Y),Z=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return L(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):R.EMPTY},e}(Q);function X(t,e){return function(r){return r.lift(new tt(t,e))}}var tt=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new et(t,this.predicate,this.thisArg))},t}(),et=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.predicate=r,i.thisArg=n,i.count=0,i}return L(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(q);function rt(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new nt(t,e))}}var nt=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new it(t,this.project,this.thisArg))},t}(),it=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.project=r,i.count=0,i.thisArg=n||i,i}return L(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(q);class ot{constructor(t){this.currentSequenceIndex=0,this.state=[],this.$sequence=t}maybeDispatchSequence(){for(let t=this.currentSequenceIndex;t<this.state.length&&this.state[t];t++)this.$sequence.next(this.state[t]),this.currentSequenceIndex++}push(t){const e=t.seq;this.state[e]=t,this.maybeDispatchSequence()}reset(){this.currentSequenceIndex=0,this.state=[]}repeatedSequence(t){return void 0!==t.seq&&this.state.map((t=>t.seq)).includes(t.seq)}repeatedSequenceZero(t){return Boolean(this.state[0])&&0===t.seq}}var st=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return L(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new K;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(Q);function ct(t){return t&&"function"==typeof t.schedule}var at=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}};function ut(t,e){return new Y((function(r){var n=new R,i=0;return n.add(e.schedule((function(){i!==t.length?(r.next(t[i++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}function ht(t,e){return e?ut(t,e):new Y(at(t))}function ft(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];return ct(r)?(t.pop(),ut(t,r)):ht(t)}function lt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var pt=lt(),dt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function yt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var bt=function(t){if(t&&"function"==typeof t[H])return n=t,function(t){var e=n[H]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(dt(t))return at(t);if(yt(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,N),t};if(t&&"function"==typeof t[pt])return e=t,function(t){for(var r=e[pt]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,i=U(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};var vt=function(t){function e(e){var r=t.call(this)||this;return r.parent=e,r}return L(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(q),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return L(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(q);function _t(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof e?function(n){return n.pipe(_t((function(r,n){return(i=t(r,n),i instanceof Y?i:new Y(bt(i))).pipe(rt((function(t,i){return e(r,t,n,i)})));var i}),r))}:("number"==typeof e&&(r=e),function(e){return e.lift(new mt(t,r))})}var mt=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new wt(t,this.project,this.concurrent))},t}(),wt=function(t){function e(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=r,i.concurrent=n,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return L(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new vt(this),r=this.destination;r.add(e);var n=function(t,e){if(!e.closed)return t instanceof Y?t.subscribe(e):bt(t)(e)}(t,e);n!==e&&r.add(n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(gt);function St(){return void 0===(t=1)&&(t=Number.POSITIVE_INFINITY),_t(W,t);var t}function Ot(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return St()(ft.apply(void 0,t))}var xt,Tt=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Et(t))},t}(),Et=function(t){function e(e){var r=t.call(this,e)||this;return r.hasPrev=!1,r}return L(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(q),jt=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.pending=!1,n}return L(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!==r&&this.delay===r&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var r=!1,n=void 0;try{this.work(t)}catch(t){r=!0,n=!!t&&t||new Error(t)}if(r)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,r){return t.call(this)||this}return L(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(R)),kt=function(){function t(e,r){void 0===r&&(r=t.now),this.SchedulerAction=e,this.now=r}return t.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(r,e)},t.now=function(){return Date.now()},t}(),Lt=new(function(t){function e(r,n){void 0===n&&(n=kt.now);var i=t.call(this,r,(function(){return e.delegate&&e.delegate!==i?e.delegate.now():n()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return L(e,t),e.prototype.schedule=function(r,n,i){return void 0===n&&(n=0),e.delegate&&e.delegate!==this?e.delegate.schedule(r,n,i):t.prototype.schedule.call(this,r,n,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},e}(kt))(jt),Ct=new Y((function(t){return t.complete()}));xt||(xt={});var At=function(){function t(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}},t.prototype.accept=function(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)},t.prototype.toObservable=function(){var t;switch(this.kind){case"N":return ft(this.value);case"E":return t=this.error,new Y((function(e){return e.error(t)}));case"C":return function(t){return t?function(t){return new Y((function(e){return t.schedule((function(){return e.complete()}))}))}(t):Ct}()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();var Mt=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Nt(t,this.delay,this.scheduler))},t}(),Nt=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.delay=r,i.scheduler=n,i.queue=[],i.active=!1,i.errored=!1,i}return L(e,t),e.dispatch=function(t){for(var e=t.source,r=e.queue,n=t.scheduler,i=t.destination;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){var o=Math.max(0,r[0].time-n.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,r=new Pt(e.now()+this.delay,t);this.queue.push(r),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(At.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(At.createComplete()),this.unsubscribe()},e}(q),Pt=function(){return function(t,e){this.time=t,this.notification=e}}();const It=(t,e)=>{const r=e.$sequence,n=new st(null);var i;return r.pipe(X((t=>l(t)||p(t))),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];return ct(r)?(t.pop(),function(e){return Ot(t,e,r)}):function(e){return Ot(t,e)}}(null),(function(t){return t.lift(new Tt)}),(i=([e,r])=>{const i=b(e,r,t.config.typing_options);return n.next({key:r.key,state:!0,delay:i,message:r}),ft(r).pipe(function(t,e){void 0===e&&(e=Lt);var r,n=(r=t)instanceof Date&&!isNaN(+r)?+t-e.now():Math.abs(t);return function(t){return t.lift(new Mt(n,e))}}(i))},_t(i,undefined,1))).subscribe((t=>n.next({key:t.key,state:!1,message:t}))),r.pipe(X((t=>!l(t)&&!p(t)))).subscribe((t=>n.next({key:t.key,state:!1,message:t}))),n};var Ut=r(468),$t=r.n(Ut),Rt=r(633),Dt=r.n(Rt);const Ft="@landbot/core/storage";class qt{constructor(){this.entry=Ft,this.storage=localStorage}get(t){const e=this._getStore();return h()(e,t)}set(t,e){const r=this._getStore();$t()(r,t,e),this.storage.setItem(this.entry,JSON.stringify(r))}remove(t){const e=this._getStore();Dt()(e,t),this.storage.setItem(this.entry,JSON.stringify(e))}setEntry(t){this.entry=`${Ft}/${t||""}`}_getStore(){return JSON.parse(this.storage.getItem(this.entry))||{}}}class Vt{constructor(){this.storage={}}get(t){return h()(this.storage,t)}set(t,e){$t()(this.storage,t,e)}remove(t){Dt()(this.storage,t)}getStore(){return this.storage}setEntry(){}}const Ht=({channelToken:t,storage_off:e})=>{const r=m()&&!e?new qt:new Vt;return r.setEntry(t),r},Wt={apiKey:"AIzaSyAzT_5GGsNISwUvpqpIMGhpqFmhsMMjuxg",authDomain:"daisho.firebaseapp.com",databaseURL:"https://daisho.firebaseio.com",storageBucket:"firebase-daisho.appspot.com",storage_off:!1,serverUrl:"https://messages.landbot.io",welcome:[],forceWebsockets:!1,configUrl:null,firebase:null,welcomeUrl:null,brandID:null,channelToken:null,customerToken:null,typing_options:{state:!0}},Bt=new class{constructor(){this.data=Wt}update(t){const e=Object.assign(Object.assign({},this.data),t);this.data=this._cleanData(e)}_cleanData(t){return Object.assign(Object.assign({},t),{serverUrl:g(t.serverUrl),welcomeUrl:g(t.welcomeUrl)})}},Yt=new Proxy(Bt,{get:(t,e)=>{if("function"==typeof t[e]){const r=t[e];return function(...e){return r.apply(t,e)}}return t.data[e]},set:(t,e,r)=>(t.data[e]=r,!0)});class zt{constructor(t){this.config=Yt,this.config.update(t),this.configUrl=_(this.config.configUrl),this.events=(()=>{const t=new(j());return t.setMaxListeners(0),t})(),this.pipelines=(t=>{const e={};return e.$sequence=(t=>{const e=new Q,r=new Q,n=new ot(r);return e.subscribe((t=>{t.hasOwnProperty("seq")?n.push(t):"assign"===t.action?setTimeout((()=>r.next(t)),1e3):r.next(t)})),t.events.on(x,(t=>{n.repeatedSequence(t)&&n.reset(),e.next(t)})),r.reset=n.reset.bind(n),r})(t),e.$typingSequence=It(t,e),e.$readableSequence=(t=>{const e=t.$typingSequence,r=new Q;return e.pipe(X((t=>!!t&&!1===t.state)),rt((t=>t.message))).subscribe((t=>r.next(t))),r})(e),e})(this),this.storage=Ht({channelToken:this.config.channelToken,storage_off:this.config.storage_off})}init(){return s(this,void 0,void 0,(function*(){if(this.configUrl)try{const t=yield this.fetchConfig(this.configUrl);this.setConfig(t)}catch(t){console.warn("@landbot/core: Could not fetch remote config. Please, use a valid configUrl property or try reloading after a few seconds.")}var t;return this.database=(this,t=this.config.firebase,new T(this,t)),this.config.forceWebsockets&&this.database.forceWebSockets(),this.customerToken=this._getCustomerToken(),this._init().then((t=>(this.events.emit("init"),t)))}))}destroy(){this._destroy()}sendMessage(t){return this._sendMessage(this._getMessageData(t))}fetchConfig(t){return s(this,void 0,void 0,(function*(){return yield a({url:t})}))}setConfig(t){this.config.update(t),this._resetConfigSensibleModules()}getInitialMessages(){return(this.config.welcome||[]).forEach(((t,e)=>{this.events.emit(x,Object.assign(Object.assign({},t),{key:v(),timestamp:e}))})),{}}getLastMessages(t){return this.database.getLastMessages(t)}getMoreMessages(t){return this.database.getMoreMessages(t)}_destroy(){this.database&&this.database.destroy(),this.events.removeAllListeners()}_getCustomerToken(){return this.config.customerToken||this.storage.get("customerToken")||null}_getInitializationData({messages:t}={}){return Promise.resolve({customerToken:this.customerToken,isNewSession:"1"!==this.storage.get("sessionStarted"),messages:t||this.getInitialMessages()})}_getMessageData(t){return Object.assign(Object.assign({type:t.type||"text",message:t.message||"",payload:t.payload||"",custom_data:t.custom_data},t),{channel_token:this.config.channelToken,customer_token:this.customerToken,metadata_info:{string:navigator.userAgent},origin:window.location.href})}_init(){return this.customerToken?this._setupClient().then((()=>this.getLastMessages())).then((t=>this._getInitializationData({messages:t}))).catch((()=>(this.customerToken=null,this._onNewSession()))):this._onNewSession()}_onConnectionChange(t){this.events.emit("database.connection",t)}_onNewMessage(t){this.events.emit(x,t)}_onNewSession(){return this.config.welcomeUrl?a({url:O({welcomeUrl:this.config.welcomeUrl}),method:"POST",body:JSON.stringify({channel_token:this.config.channelToken,version:"3"})}).then((t=>(this._storeCustomerToken(t.customer_token),this.database.auth(t)))).then(this._setupDatabaseListeners.bind(this)).catch((t=>{console.error({message:t.message,stack:t.stack})})).then(this._getInitializationData.bind(this)):this._getInitializationData()}_sendMessage(t){return this.pipelines.$sequence.reset(),a({method:"POST",url:S({serverUrl:this.config.serverUrl}),body:JSON.stringify(t)}).then(this._updateCustomerToken.bind(this)).then((()=>{this.storage.set("sessionStarted","1")}))}_setupClient(){return this.setupPromise=this._getAuthWithWelcomeFallback().then((t=>this.database.auth(t))).then(this._setupDatabaseListeners.bind(this)),this.setupPromise}_getAuthWithWelcomeFallback(){return this.config.welcomeUrl?this._getAuthToken({serverUrl:this.config.welcomeUrl}).catch((t=>(this.config.update({welcomeUrl:null}),console.error(t),this._getAuthToken({serverUrl:this.config.serverUrl})))):this._getAuthToken({serverUrl:this.config.serverUrl})}_getAuthToken({serverUrl:t}){return this.database.authRequest({customerToken:this.customerToken,channelToken:this.config.channelToken,serverUrl:t})}_setupDatabaseListeners(t){const e=t.customer_id,{brandID:r}=this.config,n=`/${r}/messages/${e}/messages`,i=`/${r}/messages/${e}/presence`;this.database.setChatReference(n),this.database.setStatusReference(i),this.database.setNewMessageListener(this._onNewMessage.bind(this)),this.database.setConnectionTrackingListener(this._onConnectionChange.bind(this))}_storeCustomerToken(t){this.customerToken=t,this.storage.set("customerToken",t)}_updateCustomerToken(t){const e=t.customer_token;if(e!==this.customerToken)return this._storeCustomerToken(e),this._setupClient()}_resetConfigSensibleModules(){this.storage=Ht({channelToken:this.config.channelToken,storage_off:this.config.storage_off})}}zt.utils=o;class Kt{constructor(t){this.config=t,this.database=new Gt(this.config)}init(){return s(this,void 0,void 0,(function*(){return yield this.database.auth(this.config)}))}destroy(){return s(this,void 0,void 0,(function*(){this.database.destroy()}))}setChat(t,e){return s(this,void 0,void 0,(function*(){yield this.database.unsetNewMessageListener(),yield this.database.setChatReference(`brands/${this.config.brand_uuid}/users/${t}/chats/${e}/messages`)}))}onMessage(t){return s(this,void 0,void 0,(function*(){yield this.database.setNewMessageListener(t)}))}getLastMessages(){return s(this,void 0,void 0,(function*(){return yield this.database.getLastMessages()}))}getMoreMessages(){return s(this,void 0,void 0,(function*(){return yield this.database.getMoreMessages()}))}}class Gt{constructor(t){this.firstTimestamp=0,this.firebaseApp=t.firebase.initializeApp({apiKey:t.api_key,appId:t.app_id,projectId:t.project_id}),void 0!==t.experimentalAutoDetectLongPolling&&this.firebaseApp.firestore().settings({experimentalAutoDetectLongPolling:t.experimentalAutoDetectLongPolling}),void 0!==t.useFetchStreams&&this.firebaseApp.firestore().settings({useFetchStreams:t.useFetchStreams})}auth(t){return this.firebaseApp.auth().signInWithCustomToken(t.brand_token.toString())}destroy(){return this.firebaseApp.delete()}setChatReference(t){this.chatRef=this.firebaseApp.firestore().collection(t)}setNewMessageListener(t){return s(this,void 0,void 0,(function*(){this.newMessageListener=this.chatRef.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const r=e.doc.data(),n=Object.assign(Object.assign({},r),{id:e.doc.id,key:e.doc.id,timestamp:r.timestamp*=1e3});t(n)}}))}))}))}unsetNewMessageListener(){return this.chatRef&&this.newMessageListener(),Promise.resolve()}getLastMessages(t=20){return s(this,void 0,void 0,(function*(){return this.chatRef.orderBy("timestamp","desc").limit(t).get().then((t=>{const e={};return t.forEach((t=>{const r=t.data();e[t.id]=Object.assign(Object.assign({},r),{id:t.id,key:t.id,timestamp:r.timestamp*=1e3})})),this._updateFirstTimestamp(e),e}))}))}getMoreMessages(t=20){return this.chatRef.orderBy("timestamp","desc").startAfter(this.firstTimestamp/1e3).limit(t).get().then((t=>{const e={};return t.forEach((t=>{const r=t.data();e[t.id]=Object.assign(Object.assign({},r),{id:t.id,key:t.id,timestamp:r.timestamp*=1e3})})),this._updateFirstTimestamp(e),e}))}_updateFirstTimestamp(t){if(t){const e=Object.values(t).sort(((t,e)=>t.timestamp-e.timestamp))[0];e&&(this.firstTimestamp=e.timestamp)}}}const Jt=window.Landbot||{};window.Landbot=Object.assign(Object.assign({},Jt),{Core:zt});const Qt=zt})(),n})()}));